# PodDisruptionBudget for API - Ensures high availability during updates
# Scales with cluster size: 2 nodes = 2 pods, 4+ nodes = 50% pods
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: healthcare-api-pdb
  namespace: healthcare-backend
spec:
  # For 2-3 nodes: Keep at least 2 pods
  # For 4+ nodes: Keep at least 50% of pods (scales automatically)
  minAvailable: 2  # Minimum 2 pods, but scales with HPA
  # Alternative for larger clusters: uncomment below and comment minAvailable
  # maxUnavailable: 50%  # Allow up to 50% pods to be unavailable
  selector:
    matchLabels:
      app: healthcare-api
---
# PodDisruptionBudget for Worker - Ensures job processing continuity
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: healthcare-worker-pdb
  namespace: healthcare-backend
spec:
  minAvailable: 1  # Always keep at least 1 worker running
  # For larger clusters, consider: maxUnavailable: 50%
  selector:
    matchLabels:
      app: healthcare-worker
---
# PodDisruptionBudget for Redis - Protect cache during maintenance
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: redis-pdb
  namespace: healthcare-backend
spec:
  minAvailable: 2  # Keep majority of Redis nodes running
  selector:
    matchLabels:
      app: redis
---
# PodDisruptionBudget for PostgreSQL - Critical data protection
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: postgres-pdb
  namespace: healthcare-backend
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: postgres
