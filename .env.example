# ============================================================================
# ENVIRONMENT VARIABLES TEMPLATE
# ============================================================================
# Copy this file to .env and update with your values
# For environment-specific configs, create .env.development, .env.production, etc.
# DO NOT commit actual secrets to version control
#
# ARCHITECTURE: Single Backend API, Multiple Clinic Frontends
# ============================================================
# - ONE backend API (API_URL) serves ALL clinics
# - Only clinic-related data and configurations differ between clinics
# - All clinics share the same backend infrastructure:
#   * Single database with row-level security (automatic clinic data isolation)
#   * Shared cache, services, and infrastructure
#   * Same backend codebase and deployment
# - Each clinic can have:
#   * Separate frontend URL (e.g., clinic1.viddhakarma.com)
#   * Clinic-specific credentials (email, WhatsApp, SMS, Firebase, etc.)
#   * Clinic-specific settings stored in database
# ============================================================================

# Application Environment
NODE_ENV=development
IS_DEV=true

# Application Configuration
PORT=8088
API_PREFIX=/api/v1
HOST=0.0.0.0
BIND_ADDRESS=0.0.0.0
BASE_URL=http://localhost:8088
API_URL=http://localhost:8088

# Frontend URL Configuration (Multi-Tenant Support)
# ===================================================
# ARCHITECTURE: Single Backend API, Multiple Clinic Frontends
# - ONE backend API serves ALL clinics (API_URL)
# - Each clinic can have its own frontend URL (e.g., clinic1.viddhakarma.com, clinic2.viddhakarma.com)
# - Only clinic-related data and configurations differ between clinics
# - All clinics share the same backend infrastructure (database, cache, services)
#
# FRONTEND_URL: Default/fallback frontend URL (used when clinic-specific URL not available)
# - Include ALL clinic frontend URLs in CORS_ORIGIN (see CORS Configuration below)
#
# Clinic-Specific Frontend URLs (Optional):
# Use pattern: CLINIC_{CLINIC_NAME}_FRONTEND_URL or CLINIC_{SUBDOMAIN}_FRONTEND_URL
# Example:
#   CLINIC_AADESH_AYURVEDELAY_FRONTEND_URL=https://aadesh.viddhakarma.com
#   CLINIC_AADESH_FRONTEND_URL=https://aadesh.viddhakarma.com
#   CLINIC_CLINIC2_FRONTEND_URL=https://clinic2.viddhakarma.com
#
# Priority: Database config > Clinic-specific env vars > FRONTEND_URL (global fallback)
FRONTEND_URL=http://localhost:3000

# Database Configuration
# In Docker: use container name 'postgres', locally: use 'localhost'
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/userdb?connection_limit=50&pool_timeout=20
DIRECT_URL=postgresql://postgres:postgres@localhost:5432/userdb
DATABASE_SQL_INJECTION_PREVENTION_ENABLED=true
DATABASE_ROW_LEVEL_SECURITY_ENABLED=true
DATABASE_DATA_MASKING_ENABLED=true
DATABASE_RATE_LIMITING_ENABLED=true
DATABASE_READ_REPLICAS_ENABLED=false
DATABASE_READ_REPLICAS_STRATEGY=round-robin
DATABASE_READ_REPLICAS_URLS=

# Cache Configuration
CACHE_ENABLED=true
CACHE_PROVIDER=dragonfly

# Dragonfly Configuration (Primary Cache Provider)
# In Docker: use container name 'dragonfly', locally: use 'localhost'
DRAGONFLY_ENABLED=true
DRAGONFLY_HOST=localhost
DRAGONFLY_PORT=6379
DRAGONFLY_KEY_PREFIX=healthcare:
DRAGONFLY_PASSWORD=

# Redis Configuration (Only needed if CACHE_PROVIDER=redis)
# Since CACHE_PROVIDER=dragonfly, Redis is not needed
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_TTL=3600
REDIS_PREFIX=healthcare:
REDIS_PASSWORD=
REDIS_ENABLED=false

# JWT Configuration
JWT_SECRET=your-jwt-secret-key-min-32-chars-long
JWT_EXPIRATION=24h
JWT_ACCESS_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-jwt-refresh-secret-key-min-32-chars-long

# Prisma Configuration
PRISMA_SCHEMA_PATH=/app/src/libs/infrastructure/database/prisma/schema.prisma

# Logging Configuration
LOG_LEVEL=debug
ENABLE_AUDIT_LOGS=true

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=1000
API_RATE_LIMIT=100
AUTH_RATE_LIMIT=5
HEAVY_RATE_LIMIT=10
USER_RATE_LIMIT=50
HEALTH_RATE_LIMIT=200
MAX_AUTH_ATTEMPTS=5
AUTH_ATTEMPT_WINDOW=1800
MAX_CONCURRENT_SESSIONS=5
SESSION_INACTIVITY_THRESHOLD=900

# Security Configuration
SECURITY_RATE_LIMIT=true
SECURITY_RATE_LIMIT_MAX=1000
SECURITY_RATE_LIMIT_WINDOW_MS=15000
TRUST_PROXY=1

# =============================================================================
# EMAIL CONFIGURATION
# =============================================================================
# EMAIL_PROVIDER controls the legacy EmailService (used when clinicId is absent).
# VALID VALUES: 'smtp' or 'api'
#   - 'api'  → Uses ZEPTOMAIL_SEND_MAIL_TOKEN (ZeptoMail) if set, otherwise falls back to MAILTRAP_API_TOKEN
#   - 'smtp' → Uses EMAIL_HOST / EMAIL_USER / EMAIL_PASSWORD (SMTP relay)
#
# For the multi-tenant path (when a clinicId IS provided in the request),
# the system always uses ProviderFactory which reads ZEPTOMAIL_* vars regardless of EMAIL_PROVIDER.
# ⚠️  Do NOT set EMAIL_PROVIDER=zeptomail — that is NOT a valid value.
EMAIL_PROVIDER=api

# App display name (used in email From name and templates)
APP_NAME=Healthcare App

# ZeptoMail — Transactional Email via Zoho ZeptoMail API
# Get credentials at: https://zeptomail.zoho.com → Mail Agents → [your agent] → Send Mail Token
# The dashboard shows a token like:  Zoho-enczapikey PHtE6r0F...
# You may paste EITHER the full string (including "Zoho-enczapikey") OR just the key.
# The adapter automatically strips the prefix, so both formats work.
ZEPTOMAIL_SEND_MAIL_TOKEN=Zoho-enczapikey YOUR_TOKEN_HERE

# The sender address MUST be a verified Sender Address in your ZeptoMail Mail Agent.
# Go to: ZeptoMail → Mail Agents → [agent] → Sender Addresses → Add & Verify
ZEPTOMAIL_FROM_EMAIL=noreply@yourdomain.com
ZEPTOMAIL_FROM_NAME=Healthcare App

# Optional: Dedicated bounce-handling address (leave blank if not configured)
ZEPTOMAIL_BOUNCE_ADDRESS=

# Optional: Webhook secret for verifying incoming ZeptoMail webhook events (production only).
# In production, set this to a random string and configure the SAME value in
# ZeptoMail dashboard → Mail Agents → [agent] → Webhooks → Secret Key.
# The endpoint is: POST /api/v1/webhooks/zeptomail
# Without this var, webhooks are accepted without signature verification (dev-safe, not prod-safe).
ZEPTOMAIL_WEBHOOK_SECRET=

# Global fallback sender fields
DEFAULT_FROM_EMAIL=noreply@yourdomain.com
DEFAULT_FROM_NAME=Healthcare App
SUPPORT_EMAIL=support@yourdomain.com

# Clinic-Specific Configuration (Multi-Tenant Support)
# ===================================================
# ARCHITECTURE: Single Backend API with Clinic-Specific Data Only
# - ONE backend API (API_URL) serves ALL clinics
# - Only clinic-related data and configurations differ
# - All clinics share: Database, Cache, Services, Infrastructure
# - Each clinic can have: Separate frontend URL, credentials, settings
#
# Configuration Pattern:
# CLINIC_{CLINIC_NAME}_{CONFIG_KEY}
# CLINIC_{APP_NAME}_{CONFIG_KEY}
# CLINIC_{SUBDOMAIN}_{CONFIG_KEY}
#
# IMPORTANT: Clinic names are sanitized (spaces/special chars → underscores, uppercase)
# Example: "Aadesh Ayurvedalay" → "AADESH_AYURVEDELAY"
#
# Supported Clinic-Specific Variables:
# ====================================
#
# 1. Frontend URLs
#    CLINIC_{NAME}_FRONTEND_URL=https://clinic1.viddhakarma.com
#
# 2. Email Configuration (ZeptoMail)
#    CLINIC_{NAME}_ZEPTOMAIL_SEND_MAIL_TOKEN=clinic_specific_token
#    CLINIC_{NAME}_ZEPTOMAIL_FROM_EMAIL=noreply@clinic.com
#    CLINIC_{NAME}_ZEPTOMAIL_FROM_NAME=Clinic Name
#    CLINIC_{NAME}_ZEPTOMAIL_BOUNCE_ADDRESS=bounces@clinic.com
#
# 3. WhatsApp Configuration
#    CLINIC_{NAME}_WHATSAPP_API_KEY=clinic_whatsapp_key
#    CLINIC_{NAME}_WHATSAPP_PHONE_NUMBER_ID=clinic_phone_id
#    CLINIC_{NAME}_WHATSAPP_BUSINESS_ACCOUNT_ID=clinic_business_id
#    CLINIC_{NAME}_WHATSAPP_OTP_TEMPLATE_ID=clinic_otp_template
#    CLINIC_{NAME}_WHATSAPP_APPOINTMENT_TEMPLATE_ID=clinic_appointment_template
#    CLINIC_{NAME}_WHATSAPP_PRESCRIPTION_TEMPLATE_ID=clinic_prescription_template
#
# 4. SMS Configuration
#    CLINIC_{NAME}_SMS_API_KEY=clinic_sms_key
#    CLINIC_{NAME}_SMS_API_SECRET=clinic_sms_secret
#    CLINIC_{NAME}_SMS_FROM_NUMBER=clinic_sms_number
#
# 5. Firebase Configuration (Push Notifications)
#    CLINIC_{NAME}_FIREBASE_PROJECT_ID=clinic_firebase_project
#    CLINIC_{NAME}_FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
#    CLINIC_{NAME}_FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@clinic-project.iam.gserviceaccount.com
#    CLINIC_{NAME}_FIREBASE_DATABASE_URL=https://clinic-project.firebaseio.com
#    CLINIC_{NAME}_FIREBASE_VAPID_KEY=clinic_vapid_key
#
# 6. OpenVidu Configuration (Video Consultations)
#    CLINIC_{NAME}_OPENVIDU_URL=https://video.clinic.com
#    CLINIC_{NAME}_OPENVIDU_SECRET=clinic_openvidu_secret
#    CLINIC_{NAME}_OPENVIDU_DOMAIN=video.clinic.com
#
# 7. S3 Storage Configuration (File Storage)
#    CLINIC_{NAME}_S3_BUCKET=clinic-bucket-name
#    CLINIC_{NAME}_S3_ACCESS_KEY_ID=clinic_s3_access_key
#    CLINIC_{NAME}_S3_SECRET_ACCESS_KEY=clinic_s3_secret_key
#    CLINIC_{NAME}_S3_ENDPOINT=https://eu2.contabostorage.com
#    CLINIC_{NAME}_S3_REGION=eu-central-1
#
# 8. Social Auth Configuration
#    CLINIC_{NAME}_GOOGLE_CLIENT_ID=clinic_google_client_id
#    CLINIC_{NAME}_GOOGLE_CLIENT_SECRET=clinic_google_secret
#    CLINIC_{NAME}_FACEBOOK_APP_ID=clinic_facebook_app_id
#    CLINIC_{NAME}_FACEBOOK_APP_SECRET=clinic_facebook_secret
#    CLINIC_{NAME}_APPLE_CLIENT_ID=clinic_apple_client_id
#    CLINIC_{NAME}_APPLE_CLIENT_SECRET=clinic_apple_secret
#
# Example Configuration for Multiple Clinics:
# ===========================================
# # Clinic 1: Aadesh Ayurvedalay
# CLINIC_AADESH_AYURVEDELAY_FRONTEND_URL=https://aadesh.viddhakarma.com
# CLINIC_AADESH_AYURVEDELAY_ZEPTOMAIL_SEND_MAIL_TOKEN=aadesh_token
# CLINIC_AADESH_AYURVEDELAY_ZEPTOMAIL_FROM_EMAIL=noreply@aadesh.com
# CLINIC_AADESH_AYURVEDELAY_WHATSAPP_API_KEY=aadesh_whatsapp_key
# CLINIC_AADESH_AYURVEDELAY_SMS_API_KEY=aadesh_sms_key
# CLINIC_AADESH_AYURVEDELAY_FIREBASE_PROJECT_ID=aadesh-firebase
#
# # Clinic 2: Vishwamurti Ayurvedelay
# CLINIC_VISHWAMURTI_AYURVEDELAY_FRONTEND_URL=https://vishwamurti.viddhakarma.com
# CLINIC_VISHWAMURTI_AYURVEDELAY_ZEPTOMAIL_SEND_MAIL_TOKEN=vishwamurti_token
# CLINIC_VISHWAMURTI_AYURVEDELAY_ZEPTOMAIL_FROM_EMAIL=noreply@vishwamurti.com
# CLINIC_VISHWAMURTI_AYURVEDELAY_WHATSAPP_API_KEY=vishwamurti_whatsapp_key
# CLINIC_VISHWAMURTI_AYURVEDELAY_SMS_API_KEY=vishwamurti_sms_key
# CLINIC_VISHWAMURTI_AYURVEDELAY_FIREBASE_PROJECT_ID=vishwamurti-firebase
#
# Priority Order:
# ==============
# 1. Database Settings (highest priority) - Via API endpoints
# 2. Clinic-Specific Environment Variables - By name, app_name, or subdomain
# 3. Global Environment Variables (fallback) - Default for all clinics
#
# IMPORTANT: Single Backend Architecture
# ======================================
# 1. ONE backend API (API_URL) serves ALL clinics
# 2. Each clinic's frontend should send X-Clinic-ID header in all requests
# 3. Backend validates clinic ID via ClinicGuard and isolates data automatically
# 4. Add ALL clinic frontend URLs to CORS_ORIGIN (comma-separated, no spaces after commas)
# 5. Example CORS_ORIGIN: https://aadesh.viddhakarma.com,https://vishwamurti.viddhakarma.com,https://www.viddhakarma.com
#
# Data Isolation:
# - Row-level security automatically filters data by clinicId
# - Each clinic only sees their own data
# - Shared infrastructure (database, cache) with clinic-level isolation

# Mailtrap Configuration (Optional - Legacy EmailService / Development Only)
# Mailtrap is used by legacy EmailService when EMAIL_PROVIDER=api and clinicId is not provided
# For multi-tenant system, use ZeptoMail or AWS SES via ProviderFactory
# Get your API token from: https://mailtrap.io/api-tokens
MAILTRAP_API_TOKEN=

# SMTP Configuration (Optional - Legacy EmailService / Development Only)
# SMTP is used by legacy EmailService when EMAIL_PROVIDER=smtp and clinicId is not provided
# For multi-tenant system, use SMTP adapter via ProviderFactory
EMAIL_HOST=live.smtp.mailtrap.io
EMAIL_PORT=2525
EMAIL_SECURE=false
EMAIL_USER=api
EMAIL_PASSWORD=
EMAIL_FROM=noreply@healthcare.com

# CORS Configuration
# IMPORTANT: For multi-tenant setup, include ALL clinic frontend URLs in CORS_ORIGIN
# Each clinic can have its own frontend URL (e.g., clinic1.viddhakarma.com, clinic2.viddhakarma.com)
# All clinics share the same backend API (e.g., api.ishswami.in)
# Format: Comma-separated list of allowed origins (no spaces after commas)
# Example: https://clinic1.viddhakarma.com,https://clinic2.viddhakarma.com,https://www.viddhakarma.com
CORS_ORIGIN=http://localhost:3000,http://localhost:8088,http://localhost:8082,http://localhost:8443
CORS_CREDENTIALS=true
CORS_METHODS=GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS

# Service URLs
SWAGGER_URL=/docs
BULL_BOARD_URL=/queue-dashboard
SOCKET_URL=/socket.io
REDIS_COMMANDER_URL=http://localhost:8082
PRISMA_STUDIO_URL=http://localhost:5555
PGADMIN_URL=http://localhost:5050

# WhatsApp Configuration (optional - enable when ready)
# WhatsApp is integrated but disabled by default
# Set WHATSAPP_ENABLED=true and configure credentials to enable
WHATSAPP_ENABLED=false
WHATSAPP_API_URL=https://graph.facebook.com/v17.0
WHATSAPP_API_KEY=
WHATSAPP_PHONE_NUMBER_ID=
WHATSAPP_BUSINESS_ACCOUNT_ID=
WHATSAPP_OTP_TEMPLATE_ID=otp_verification
WHATSAPP_APPOINTMENT_TEMPLATE_ID=appointment_reminder
WHATSAPP_PRESCRIPTION_TEMPLATE_ID=prescription_notification

# Video Configuration (Dual Provider: OpenVidu primary, Jitsi fallback)
VIDEO_ENABLED=true
VIDEO_PROVIDER=openvidu

# OpenVidu Configuration (Primary - like Dragonfly in cache pattern)
OPENVIDU_URL=https://localhost:4443
OPENVIDU_SECRET=your-openvidu-secret
OPENVIDU_DOMAIN=localhost
# OpenVidu Webhook Configuration (Optimized Architecture: Webhooks → Backend → Socket.IO)
# Enable webhooks to reduce Socket.IO load for video events
# Set OPENVIDU_WEBHOOK_ENDPOINT to your API webhook URL (e.g., https://api.yourdomain.com/api/v1/webhooks/openvidu)
OPENVIDU_WEBHOOK_ENABLED=false
OPENVIDU_WEBHOOK_ENDPOINT=http://localhost:8088/api/v1/webhooks/openvidu
OPENVIDU_WEBHOOK_EVENTS=sessionCreated,sessionDestroyed,participantJoined,participantLeft,recordingStarted,recordingStopped

# Jitsi Configuration (Fallback - like Redis in cache pattern)
JITSI_DOMAIN=localhost:8443
JITSI_BASE_DOMAIN=localhost
JITSI_SUBDOMAIN=localhost
JITSI_APP_ID=healthcare-jitsi-app
JITSI_APP_SECRET=your-jitsi-secret-change-in-production
JITSI_BASE_URL=https://localhost:8443
JITSI_WS_URL=wss://localhost:8443/xmpp-websocket
JITSI_ENABLE_RECORDING=true
JITSI_ENABLE_WAITING_ROOM=true

# Session Configuration (Fastify Session with CacheService/Dragonfly)
SESSION_SECRET=your-session-secret-min-32-chars-long
SESSION_TIMEOUT=86400
SESSION_SECURE_COOKIES=false
SESSION_SAME_SITE=lax
COOKIE_SECRET=your-cookie-secret-min-32-chars

# Firebase Configuration (REQUIRED for push notifications)
# Firebase is used as primary provider for push notifications
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com
FIREBASE_DATABASE_URL=
FIREBASE_VAPID_KEY=your-firebase-vapid-key

# AWS Configuration (for SNS push notifications fallback and SES email)
# AWS SNS is used as fallback when FCM fails for push notifications
# AWS SES is available as email provider (can be configured per-clinic)
AWS_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_SNS_REGION=
AWS_SNS_IOS_PLATFORM_ARN=
AWS_SNS_ANDROID_PLATFORM_ARN=

# AWS SES Configuration (Optional - Available as Email Provider)
# AWS SES can be configured per-clinic as primary or fallback email provider
# Currently using ZeptoMail as primary email provider
# To use AWS SES: Configure per-clinic via CommunicationConfigService
AWS_SES_FROM_EMAIL=
AWS_SES_FROM_NAME=
AWS_SES_REGION=

# Google OAuth Configuration (optional - configure when needed)
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:8088/auth/google/callback

# Social Auth Configuration (optional - configure when needed)
FACEBOOK_APP_ID=
FACEBOOK_APP_SECRET=
FACEBOOK_REDIRECT_URI=http://localhost:8088/auth/facebook/callback
APPLE_CLIENT_ID=
APPLE_CLIENT_SECRET=
APPLE_REDIRECT_URI=http://localhost:8088/auth/apple/callback

# S3 Storage Configuration (Contabo S3 + Local Storage Setup)
# Supports Contabo S3 (primary), AWS S3, Wasabi, or local storage (fallback)
# See docs/guides/STORAGE_CONFIGURATION.md for detailed setup instructions
S3_ENABLED=false
S3_PROVIDER=contabo
S3_ENDPOINT=https://eu2.contabostorage.com
S3_REGION=eu-central-1
S3_BUCKET=healthcaredata
S3_ACCESS_KEY_ID=your-contabo-access-key-id
S3_SECRET_ACCESS_KEY=your-contabo-secret-access-key
S3_FORCE_PATH_STYLE=true
S3_PUBLIC_URL_EXPIRATION=3600
# CDN URL Configuration
# For Contabo provider: CDN URL is automatically generated from S3_ENDPOINT, S3_ACCESS_KEY_ID, and S3_BUCKET
# Format: https://{endpoint}/{access-key-id}:{bucket}
# Example: https://eu2.contabostorage.com/{access-key-id}:healthcaredata
# Only set this if you want to use a different CDN provider (e.g., Cloudflare, AWS CloudFront)
CDN_URL=

# Docker Configuration
DOCKER_ENV=false
DOCKER_NETWORK=app-network

# Credential Encryption (AES-256 key for storing provider secrets in DB)
# The code reads COMMUNICATION_ENCRYPTION_KEY first, then falls back to ENCRYPTION_KEY.
# Any non-empty string works — a longer, random value is more secure.
# Generate a strong value: openssl rand -base64 32
COMMUNICATION_ENCRYPTION_KEY=change-me-use-a-long-random-string-here

# App Login URL (used in password-reset confirmation emails)
APP_LOGIN_URL=http://localhost:3000/login

# =============================================================================
# PAYMENT — Cashfree (Primary Provider)
# =============================================================================
# Get credentials from: https://merchant.cashfree.com → Developers → API Keys
# CASHFREE_ENVIRONMENT: 'sandbox' for testing, 'production' for live payments
CASHFREE_ENVIRONMENT=sandbox
CASHFREE_APP_ID=your-cashfree-app-id
CASHFREE_SECRET_KEY=your-cashfree-secret-key
# API version — use the latest unless Cashfree support tells you otherwise
CASHFREE_API_VERSION=2025-01-01
# Return/Notify URLs sent inside each order — must be publicly reachable in production
CASHFREE_RETURN_URL=http://localhost:3000/payment/callback
CASHFREE_NOTIFY_URL=http://localhost:8088/api/v1/payments/cashfree/webhook

# =============================================================================
# PAYMENT — Razorpay (Optional Fallback)
# =============================================================================
RAZORPAY_KEY_ID=
RAZORPAY_KEY_SECRET=

# Default payment currency
PAYMENT_DEFAULT_CURRENCY=INR
