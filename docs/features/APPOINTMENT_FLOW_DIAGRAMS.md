# π“ Appointment & Follow-Up Flow Diagrams

## π“‹ Table of Contents

1. [Regular Appointment Lifecycle](#regular-appointment-lifecycle)
2. [Follow-Up Appointment Flow](#follow-up-appointment-flow)
3. [Recurring Appointment Series](#recurring-appointment-series)
4. [Appointment Chain Structure](#appointment-chain-structure)
5. [State Transitions](#state-transitions)

---

## π”„ Regular Appointment Lifecycle

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    REGULAR APPOINTMENT LIFECYCLE                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

                    [PATIENT/DOCTOR REQUEST]
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  VALIDATE REQUEST   β”‚
                    β”‚  - RBAC Check       β”‚
                    β”‚  - Business Rules   β”‚
                    β”‚  - Input Validation β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  CHECK CONFLICTS    β”‚
                    β”‚  - Doctor Schedule  β”‚
                    β”‚  - Resource Avail   β”‚
                    β”‚  - Patient Appts    β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  CREATE APPOINTMENT β”‚
                    β”‚  Status: SCHEDULED  β”‚
                    β”‚  parentId: null     β”‚
                    β”‚  isFollowUp: false  β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  QUEUE OPERATIONS   β”‚
                    β”‚  - Notifications     β”‚
                    β”‚  - Cache Update      β”‚
                    β”‚  - Event Emission    β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  HIPAA AUDIT LOG    β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    [APPOINTMENT CREATED]
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  STATUS: SCHEDULED β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β–Ό                   β–Ό
          [CONFIRMED]          [CHECKED_IN]
                    β”‚                   β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  STATUS: IN_PROGRESS β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  STATUS: COMPLETED  β”‚
                    β”‚  completedAt: now() β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β–Ό                   β–Ό
        [NO FOLLOW-UP]        [FOLLOW-UP REQUIRED]
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ CREATE FOLLOW-UP   β”‚
                    β”‚          β”‚ PLAN               β”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ AUTO-SCHEDULE (if    β”‚
                    β”‚          β”‚ date provided)      β”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚
                    β–Ό
            [END OF FLOW]
```

---

## π” Follow-Up Appointment Flow

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    FOLLOW-UP APPOINTMENT FLOW                    β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

                    [APPOINTMENT COMPLETED]
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  followUpRequired?  β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β–Ό                   β–Ό
              [NO]                 [YES]
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ CREATE FOLLOW-UP   β”‚
                    β”‚          β”‚ PLAN               β”‚
                    β”‚          β”‚ - appointmentId     β”‚
                    β”‚          β”‚ - scheduledFor     β”‚
                    β”‚          β”‚ - followUpType     β”‚
                    β”‚          β”‚ - status: scheduledβ”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ followUpDate        β”‚
                    β”‚          β”‚ provided?           β”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚                   β”‚
                    β”‚          β–Ό                   β–Ό
                    β”‚    [YES]                 [NO]
                    β”‚          β”‚                   β”‚
                    β”‚          β”‚                   β–Ό
                    β”‚          β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚          β”‚ PLAN STAYS IN       β”‚
                    β”‚          β”‚          β”‚ "scheduled" STATUS   β”‚
                    β”‚          β”‚          β”‚ (Manual scheduling)  β”‚
                    β”‚          β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚
                    β”‚          β–Ό
                    β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  β”‚ CREATE FOLLOW-UP    β”‚
                    β”‚  β”‚ APPOINTMENT         β”‚
                    β”‚  β”‚ - parentAppointmentIdβ”‚
                    β”‚  β”‚ - isFollowUp: true   β”‚
                    β”‚  β”‚ - followUpReason    β”‚
                    β”‚  β”‚ - status: SCHEDULED β”‚
                    β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚
                    β”‚          β–Ό
                    β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  β”‚ LINK PLAN TO        β”‚
                    β”‚  β”‚ APPOINTMENT         β”‚
                    β”‚  β”‚ - followUpAppointmentIdβ”‚
                    β”‚  β”‚ - status: completed β”‚
                    β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚
                    β”‚          β–Ό
                    β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  β”‚ SEND NOTIFICATIONS  β”‚
                    β”‚  β”‚ - Patient           β”‚
                    β”‚  β”‚ - Doctor            β”‚
                    β”‚  β”‚ - Reminders          β”‚
                    β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚
                    β–Ό
            [END OF FLOW]
```

---

## π”‚ Recurring Appointment Series

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  RECURRING APPOINTMENT SERIES                   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

                    [CREATE RECURRING SERIES]
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  VALIDATE TEMPLATE  β”‚
                    β”‚  - Template exists  β”‚
                    β”‚  - Pattern valid    β”‚
                    β”‚  - Dates valid      β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  CREATE SERIES      β”‚
                    β”‚  - seriesId         β”‚
                    β”‚  - startDate        β”‚
                    β”‚  - endDate          β”‚
                    β”‚  - status: active   β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  GENERATE DATES     β”‚
                    β”‚  Based on pattern:  β”‚
                    β”‚  - WEEKLY           β”‚
                    β”‚  - MONTHLY           β”‚
                    β”‚  - DAILY            β”‚
                    β”‚  - CUSTOM           β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  CREATE APPOINTMENTSβ”‚
                    β”‚  FOR EACH DATE:     β”‚
                    β”‚  - seriesId         β”‚
                    β”‚  - seriesSequence   β”‚
                    β”‚  - status: SCHEDULEDβ”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  SERIES STRUCTURE   β”‚
                    β”‚                     β”‚
                    β”‚  RecurringSeries    β”‚
                    β”‚    β”β”€β”€ Appt 1       β”‚
                    β”‚    β”‚   (seq: 1)     β”‚
                    β”‚    β”β”€β”€ Appt 2       β”‚
                    β”‚    β”‚   (seq: 2)     β”‚
                    β”‚    β”β”€β”€ Appt 3       β”‚
                    β”‚    β”‚   (seq: 3)     β”‚
                    β”‚    β””β”€β”€ ...          β”‚
                    β”‚        (seq: N)     β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  QUEUE NOTIFICATIONSβ”‚
                    β”‚  FOR ALL APPOINTMENTSβ”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    [SERIES CREATED]
```

---

## π”— Appointment Chain Structure

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    APPOINTMENT CHAIN STRUCTURE                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  ORIGINAL APPOINTMENTβ”‚
                    β”‚  (app-1)             β”‚
                    β”‚  - type: CONSULTATIONβ”‚
                    β”‚  - date: 2024-01-15 β”‚
                    β”‚  - status: COMPLETED β”‚
                    β”‚  - parentId: null   β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β”‚ parentAppointmentId
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β–Ό                   β–Ό
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚ FOLLOW-UP 1        β”‚  β”‚ FOLLOW-UP 2        β”‚
        β”‚ (app-2)           β”‚  β”‚ (app-3)            β”‚
        β”‚ - type: FOLLOW_UP β”‚  β”‚ - type: FOLLOW_UP  β”‚
        β”‚ - date: 2024-02-15β”‚  β”‚ - date: 2024-03-15 β”‚
        β”‚ - status: SCHEDULEDβ”‚ β”‚ - status: PENDING  β”‚
        β”‚ - parentId: app-1 β”‚  β”‚ - parentId: app-1  β”‚
        β”‚ - isFollowUp: true β”‚  β”‚ - isFollowUp: true β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚                   β”‚
                    β–Ό                   β–Ό
        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚ FOLLOW-UP PLAN 1  β”‚  β”‚ FOLLOW-UP PLAN 2  β”‚
        β”‚ (plan-1)          β”‚  β”‚ (plan-2)          β”‚
        β”‚ - status: completedβ”‚ β”‚ - status: scheduledβ”‚
        β”‚ - appId: app-2    β”‚  β”‚ - appId: null      β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

CHAIN QUERY RESULT:
{
  original: {
    id: "app-1",
    date: "2024-01-15",
    status: "COMPLETED"
  },
  followUps: [
    {
      id: "app-2",
      date: "2024-02-15",
      status: "SCHEDULED",
      followUpPlan: { id: "plan-1", ... }
    },
    {
      id: "app-3",
      date: "2024-03-15",
      status: "PENDING",
      followUpPlan: { id: "plan-2", ... }
    }
  ]
}
```

---

## π“ State Transitions

### Regular Appointment States

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              REGULAR APPOINTMENT STATE MACHINE              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    [PENDING]
        β”‚
        β”‚ (scheduled)
        β–Ό
    [SCHEDULED] β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚               β”‚
        β”‚ (confirmed)   β”‚ (cancelled)
        β–Ό               β”‚
    [CONFIRMED]         β”‚
        β”‚               β”‚
        β”‚ (checked in)   β”‚
        β–Ό               β”‚
    [CHECKED_IN]        β”‚
        β”‚               β”‚
        β”‚ (started)      β”‚
        β–Ό               β”‚
    [IN_PROGRESS]       β”‚
        β”‚               β”‚
        β”‚ (completed)    β”‚
        β–Ό               β”‚
    [COMPLETED]         β”‚
        β”‚               β”‚
        β”‚               β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚
              β”‚ (if followUpRequired)
              β–Ό
    [FOLLOW_UP_SCHEDULED]
```

### Follow-Up Plan States

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                FOLLOW-UP PLAN STATE MACHINE                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    [scheduled] β”€β”€β”€β”€β”€β”€β”€β”€β”
        β”‚               β”‚
        β”‚ (appointment  β”‚ (cancelled)
        β”‚  created)     β”‚
        β–Ό               β”‚
    [completed]         β”‚
        β”‚               β”‚
        β”‚               β”‚
        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
              β”‚
              β”‚ (if date passed)
              β–Ό
    [overdue]
```

### Follow-Up Appointment States

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚            FOLLOW-UP APPOINTMENT STATE MACHINE                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

    [FOLLOW_UP_SCHEDULED] (plan exists, not yet scheduled)
        β”‚
        β”‚ (appointment created)
        β–Ό
    [SCHEDULED]
        β”‚
        β”‚ (confirmed)
        β–Ό
    [CONFIRMED]
        β”‚
        β”‚ (checked in)
        β–Ό
    [CHECKED_IN]
        β”‚
        β”‚ (started)
        β–Ό
    [IN_PROGRESS]
        β”‚
        β”‚ (completed)
        β–Ό
    [COMPLETED]
        β”‚
        β”‚ (can create another follow-up)
        β–Ό
    [END]
```

---

## π”„ Complete Flow: Consultation β†’ Follow-Up

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         COMPLETE FLOW: CONSULTATION WITH FOLLOW-UP          β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

STEP 1: CREATE APPOINTMENT
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
POST /appointments
{
  patientId, doctorId, clinicId,
  appointmentDate: "2024-01-15T10:00:00Z",
  type: "CONSULTATION"
}
    β”‚
    β–Ό
Appointment Created:
  - id: "app-1"
  - status: "SCHEDULED"
  - parentAppointmentId: null
  - isFollowUp: false


STEP 2: PATIENT CHECKS IN
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
POST /appointments/app-1/check-in
    β”‚
    β–Ό
Status Updated:
  - status: "CHECKED_IN"
  - checkedInAt: "2024-01-15T10:00:00Z"


STEP 3: DOCTOR STARTS CONSULTATION
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
POST /appointments/app-1/start
    β”‚
    β–Ό
Status Updated:
  - status: "IN_PROGRESS"
  - startedAt: "2024-01-15T10:15:00Z"


STEP 4: DOCTOR COMPLETES WITH FOLLOW-UP
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
POST /appointments/app-1/complete
{
  followUpRequired: true,
  followUpDate: "2024-02-15",
  followUpType: "routine",
  followUpInstructions: "Monitor blood pressure"
}
    β”‚
    β–Ό
Appointment Updated:
  - status: "COMPLETED"
  - completedAt: "2024-01-15T10:45:00Z"
    β”‚
    β–Ό
FollowUpPlan Created:
  - id: "plan-1"
  - appointmentId: "app-1"
  - scheduledFor: "2024-02-15"
  - status: "completed" (auto-scheduled)
    β”‚
    β–Ό
FollowUpAppointment Created:
  - id: "app-2"
  - parentAppointmentId: "app-1"
  - isFollowUp: true
  - followUpReason: "Monitor blood pressure"
  - date: "2024-02-15T10:00:00Z"
  - status: "SCHEDULED"
    β”‚
    β–Ό
Plan Linked:
  - followUpAppointmentId: "app-2"


STEP 5: VIEW APPOINTMENT CHAIN
β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
GET /appointments/app-1/chain
    β”‚
    β–Ό
Response:
{
  original: {
    id: "app-1",
    date: "2024-01-15",
    status: "COMPLETED"
  },
  followUps: [
    {
      id: "app-2",
      date: "2024-02-15",
      status: "SCHEDULED",
      parentAppointmentId: "app-1"
    }
  ]
}
```

---

## π“ Database Relationship Diagram

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              DATABASE RELATIONSHIP DIAGRAM                   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

Appointment
β”β”€β”€ parentAppointmentId β”€β”€β”€β”€β”€β”€β”
β”‚                             β”‚
β”‚                             β–Ό
β”‚                    Appointment (Parent)
β”‚                             β”‚
β”‚                             β”‚ parentAppointmentId
β”‚                             β”‚
β”‚                             β–Ό
β”‚                    Appointment[] (Follow-Ups)
β”‚
β”β”€β”€ seriesId β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                             β”‚
β”‚                             β–Ό
β”‚                    RecurringAppointmentSeries
β”‚                             β”‚
β”‚                             β”‚ appointments[]
β”‚                             β”‚
β”‚                             β–Ό
β”‚                    Appointment[] (Series)
β”‚
β””β”€β”€ followUpPlan β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β–Ό
                    FollowUpPlan
                              β”‚
                              β”‚ followUpAppointmentId
                              β”‚
                              β–Ό
                    Appointment (Follow-Up)
```

---

## π― Decision Tree: Follow-Up Creation

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚            DECISION TREE: FOLLOW-UP CREATION                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

                    [Appointment Completed]
                              β”‚
                              β–Ό
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚ followUpRequired?   β”‚
                    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β–Ό                   β–Ό
              [NO]                 [YES]
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ Create FollowUpPlan β”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚                   β–Ό
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚ followUpDate         β”‚
                    β”‚          β”‚ provided?            β”‚
                    β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚                   β”‚
                    β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚                   β”‚
                    β”‚          β–Ό                   β–Ό
                    β”‚    [YES]                 [NO]
                    β”‚          β”‚                   β”‚
                    β”‚          β”‚                   β–Ό
                    β”‚          β”‚          β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚          β”‚ Plan Status:         β”‚
                    β”‚          β”‚          β”‚ "scheduled"          β”‚
                    β”‚          β”‚          β”‚ (Wait for manual    β”‚
                    β”‚          β”‚          β”‚  scheduling)        β”‚
                    β”‚          β”‚          β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚
                    β”‚          β–Ό
                    β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  β”‚ Create Follow-Up    β”‚
                    β”‚  β”‚ Appointment         β”‚
                    β”‚  β”‚ - parentId: app-1   β”‚
                    β”‚  β”‚ - isFollowUp: true  β”‚
                    β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚          β”‚
                    β”‚          β–Ό
                    β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚  β”‚ Link Plan to        β”‚
                    β”‚  β”‚ Appointment         β”‚
                    β”‚  β”‚ - status: completedβ”‚
                    β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β”‚
                    β–Ό
            [End]
```

---

## π“ Summary

### Key Flows Documented

1. β… **Regular Appointment**: Complete lifecycle from creation to completion
2. β… **Follow-Up Appointment**: Auto and manual scheduling flows
3. β… **Recurring Series**: Creation and management of appointment series
4. β… **Appointment Chain**: Parent-child relationships and queries
5. β… **State Transitions**: All possible state changes
6. β… **Decision Trees**: Logic for follow-up creation

### Key Relationships

- **Parent-Child**: `parentAppointmentId` links appointments
- **Plan-Appointment**: `followUpAppointmentId` links plans to appointments
- **Series-Appointments**: `seriesId` and `seriesSequence` link series

### Key Statuses

- **Appointment**: PENDING β†’ SCHEDULED β†’ CONFIRMED β†’ CHECKED_IN β†’ IN_PROGRESS β†’ COMPLETED
- **Follow-Up Plan**: scheduled β†’ completed/cancelled/overdue
- **Follow-Up Appointment**: FOLLOW_UP_SCHEDULED β†’ SCHEDULED β†’ ... β†’ COMPLETED

---

**Last Updated**: 2024-01-15


