# ============================================================================
# LOCAL-PROD ENVIRONMENT CONFIGURATION
# ============================================================================
# Local production-like environment for testing
# Uses localhost URLs and placeholder secrets
# ============================================================================

NODE_ENV=local-prod
IS_DEV=false

# Database Configuration (REQUIRED - must be set)
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/userdb?schema=public
DIRECT_URL=postgresql://postgres:postgres@postgres:5432/userdb?schema=public

# Database Security Configuration (strict for production)
DATABASE_SQL_INJECTION_PREVENTION_ENABLED=true
DATABASE_ROW_LEVEL_SECURITY_ENABLED=true
DATABASE_DATA_MASKING_ENABLED=true
DATABASE_RATE_LIMITING_ENABLED=true
DATABASE_READ_REPLICAS_ENABLED=false
DATABASE_READ_REPLICAS_STRATEGY=round-robin
DATABASE_READ_REPLICAS_URLS=

# Cache Configuration
CACHE_ENABLED=true
CACHE_PROVIDER=dragonfly

# Dragonfly Configuration (Docker service name)
DRAGONFLY_ENABLED=true
DRAGONFLY_HOST=dragonfly
DRAGONFLY_PORT=6379
DRAGONFLY_KEY_PREFIX=healthcare:local-prod:

# Redis Configuration (for Redis provider)
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_TTL=7200
REDIS_PREFIX=healthcare:
REDIS_ENABLED=true

# Application Configuration
PORT=8088
API_PREFIX=/api/v1
HOST=localhost
BIND_ADDRESS=0.0.0.0
BASE_URL=http://localhost:8088
API_URL=http://localhost:8088
FRONTEND_URL=http://localhost:3000

# JWT Configuration (Local-Prod: Placeholder secrets for local testing)
JWT_SECRET=local-prod-jwt-secret-change-in-production-min-32-chars
JWT_EXPIRATION=24h
JWT_ACCESS_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d
JWT_REFRESH_SECRET=local-prod-refresh-secret-change-in-production-min-32-chars

# Prisma Configuration
PRISMA_SCHEMA_PATH=/app/src/libs/infrastructure/database/prisma/schema.prisma

# Logging Configuration
LOG_LEVEL=info
ENABLE_AUDIT_LOGS=true

# Rate Limiting Configuration (higher limits for production)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100
API_RATE_LIMIT=500
AUTH_RATE_LIMIT=30
HEAVY_RATE_LIMIT=50
USER_RATE_LIMIT=200
HEALTH_RATE_LIMIT=1000
MAX_AUTH_ATTEMPTS=10
AUTH_ATTEMPT_WINDOW=3600
MAX_CONCURRENT_SESSIONS=20
SESSION_INACTIVITY_THRESHOLD=1800

# Security Configuration
SECURITY_RATE_LIMIT=true
SECURITY_RATE_LIMIT_MAX=500
SECURITY_RATE_LIMIT_WINDOW_MS=30000
TRUST_PROXY=1

# Email Configuration
# EMAIL_PROVIDER controls legacy EmailService (when clinicId is not provided)
# Options: 'smtp' | 'api' (api = Mailtrap)
# Note: Multi-tenant system uses ProviderFactory with clinicId (ZeptoMail, SES, SMTP)
EMAIL_PROVIDER=zeptomail

# ZeptoMail Configuration (Primary Email Provider - Multi-Tenant System)
# ZeptoMail is Zoho's transactional email service
# Get your Send Mail Token from: Mail Agents >> SMTP/API >> Send Mail Token
# Documentation: https://www.zoho.com/zeptomail/help/api/email-sending.html
# Local-Prod: Disabled by default (use Mailtrap or SMTP for local testing)
ZEPTOMAIL_ENABLED=false
# Send Mail Token (without "Zoho-enczapikey" prefix - it's added automatically)
# The adapter will automatically strip the prefix if included
# Local-Prod: Placeholder - use actual token only in production
ZEPTOMAIL_SEND_MAIL_TOKEN=LOCAL_PROD_PLACEHOLDER_TOKEN_CHANGE_IN_PRODUCTION
# From email must be from a verified domain in your ZeptoMail Mail Agent
# Local-Prod: Placeholder email
ZEPTOMAIL_FROM_EMAIL=noreply@localhost.local
ZEPTOMAIL_FROM_NAME=Healthcare App (Local)
# Optional: Bounce address for handling bounces
ZEPTOMAIL_BOUNCE_ADDRESS=bounces@localhost.local
# API Base URL (default: https://api.zeptomail.com/v1.1)
ZEPTOMAIL_API_BASE_URL=https://api.zeptomail.com/v1.1

# Clinic-Specific Credentials (Multi-Tenant Support)
# ===================================================
# Each clinic can have separate credentials using patterns:
# CLINIC_{CLINIC_NAME}_ZEPTOMAIL_SEND_MAIL_TOKEN
# CLINIC_{APP_NAME}_ZEPTOMAIL_SEND_MAIL_TOKEN
# CLINIC_{SUBDOMAIN}_ZEPTOMAIL_SEND_MAIL_TOKEN
#
# Example for clinic "Aadesh Ayurvedalay":
# CLINIC_AADESH_AYURVEDELAY_ZEPTOMAIL_SEND_MAIL_TOKEN=clinic_specific_token
# CLINIC_AADESH_AYURVEDELAY_ZEPTOMAIL_FROM_EMAIL=noreply@aadesh.com
# CLINIC_AADESH_AYURVEDELAY_WHATSAPP_API_KEY=clinic_whatsapp_key
# CLINIC_AADESH_AYURVEDELAY_SMS_API_KEY=clinic_sms_key
#
# Priority: Database config > Clinic-specific env vars > Global env vars
# PRODUCTION: Use database settings or secrets management for clinic credentials

# CORS Configuration (Local-Prod: Localhost URLs)
CORS_ORIGIN=http://localhost:3000,http://localhost:8088,http://localhost:8082,http://localhost:4443
CORS_CREDENTIALS=true
CORS_METHODS=GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS

# Service URLs
SWAGGER_URL=/docs
BULL_BOARD_URL=/queue-dashboard
SOCKET_URL=/socket.io
REDIS_COMMANDER_URL=/redis-commander
PRISMA_STUDIO_URL=/prisma
PGADMIN_URL=/pgadmin

# WhatsApp Configuration (Meta Business API)
# Set WHATSAPP_ENABLED=true and configure credentials to enable
WHATSAPP_ENABLED=false
WHATSAPP_API_URL=https://graph.facebook.com/v17.0
WHATSAPP_API_KEY=
WHATSAPP_PHONE_NUMBER_ID=
WHATSAPP_BUSINESS_ACCOUNT_ID=
WHATSAPP_OTP_TEMPLATE_ID=otp_verification
WHATSAPP_APPOINTMENT_TEMPLATE_ID=appointment_reminder
WHATSAPP_PRESCRIPTION_TEMPLATE_ID=prescription_notification
# Meta WhatsApp Webhook (required for /webhooks/whatsapp/meta)
META_WHATSAPP_WEBHOOK_VERIFY_TOKEN=
META_WHATSAPP_APP_SECRET=

# Video Configuration (Dual Provider: OpenVidu primary, Jitsi fallback)
VIDEO_ENABLED=true
VIDEO_PROVIDER=openvidu

# OpenVidu Configuration (Primary Video Provider)
# Local-Prod: Localhost URL
OPENVIDU_URL=http://localhost:4443
OPENVIDU_SECRET=local-prod-openvidu-secret-change-in-production-min-32-chars
OPENVIDU_DOMAIN=localhost
# OpenVidu Webhook Configuration (Optimized Architecture: Webhooks → Backend → Socket.IO)
# Enable webhooks to reduce Socket.IO load for video events
# Local-Prod: Disabled for local testing
OPENVIDU_WEBHOOK_ENABLED=false
OPENVIDU_WEBHOOK_ENDPOINT=http://localhost:8088/api/v1/webhooks/openvidu
OPENVIDU_WEBHOOK_EVENTS=sessionCreated,sessionDestroyed,participantJoined,participantLeft,recordingStarted,recordingStopped

# Jitsi Configuration (Fallback Video Provider)
# Local-Prod: Localhost domains
JITSI_DOMAIN=localhost
JITSI_BASE_DOMAIN=localhost
JITSI_SUBDOMAIN=meet
JITSI_APP_ID=healthcare-jitsi-app-local
JITSI_APP_SECRET=local-prod-jitsi-secret-change-in-production-min-32-chars
JITSI_BASE_URL=http://localhost:8080
JITSI_WS_URL=ws://localhost:8080/xmpp-websocket
JITSI_ENABLE_RECORDING=true
JITSI_ENABLE_WAITING_ROOM=true

# Google OAuth Configuration (Local-Prod: Localhost callback)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:8088/auth/google/callback

# Session Configuration (Fastify Session with CacheService/Dragonfly)
# Local-Prod: Placeholder secrets (minimum 32 characters)
SESSION_SECRET=local-prod-session-secret-change-in-production-min-32-chars-long
SESSION_TIMEOUT=86400
SESSION_SECURE_COOKIES=false
SESSION_SAME_SITE=lax
COOKIE_SECRET=local-prod-cookie-secret-change-in-production-min-32-chars

# Redis Configuration (for Redis provider)
# Local-Prod: No password for local testing
REDIS_PASSWORD=

# Mailtrap Configuration (Optional - Legacy EmailService / Development Only)
# Mailtrap is used by legacy EmailService when EMAIL_PROVIDER=api and clinicId is not provided
# For multi-tenant system, use ZeptoMail or AWS SES via ProviderFactory
# PRODUCTION: Not recommended - use ZeptoMail or AWS SES instead
MAILTRAP_API_TOKEN=

# SMTP Configuration (Optional - Legacy EmailService / Development Only)
# SMTP is used by legacy EmailService when EMAIL_PROVIDER=smtp and clinicId is not provided
# For multi-tenant system, use SMTP adapter via ProviderFactory
EMAIL_HOST=
EMAIL_PORT=587
EMAIL_SECURE=true
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_FROM=

# AWS Configuration (for SNS push notifications fallback and SES email)
# AWS SNS is used as fallback when FCM fails for push notifications
# AWS SES is available as email provider (can be configured per-clinic)
AWS_REGION=
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_SNS_REGION=
AWS_SNS_IOS_PLATFORM_ARN=
AWS_SNS_ANDROID_PLATFORM_ARN=

# AWS SES Configuration (Optional - Available as Email Provider)
# AWS SES can be configured per-clinic as primary or fallback email provider
# Currently using ZeptoMail as primary email provider
# To use AWS SES: Configure per-clinic via CommunicationConfigService
AWS_SES_FROM_EMAIL=
AWS_SES_FROM_NAME=
AWS_SES_REGION=

# Firebase Configuration (REQUIRED for push notifications)
# Firebase is used as primary provider for push notifications
FIREBASE_PROJECT_ID=
FIREBASE_PRIVATE_KEY=
FIREBASE_CLIENT_EMAIL=
FIREBASE_DATABASE_URL=
FIREBASE_VAPID_KEY=

# Google OAuth Configuration (optional - configure when needed)
# Local-Prod: Localhost callback URLs
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:8088/auth/google/callback

# Social Auth Configuration (optional - configure when needed)
# Local-Prod: Localhost callback URLs
FACEBOOK_APP_ID=
FACEBOOK_APP_SECRET=
FACEBOOK_REDIRECT_URI=http://localhost:8088/auth/facebook/callback
APPLE_CLIENT_ID=
APPLE_CLIENT_SECRET=
APPLE_REDIRECT_URI=http://localhost:8088/auth/apple/callback

# S3 Storage Configuration (optional - enable when you need file storage)
# Local-Prod: Disabled by default (use local storage or MinIO for testing)
S3_ENABLED=false
S3_PROVIDER=contabo
S3_ENDPOINT=https://eu2.contabostorage.com
S3_REGION=eu-central-1
S3_BUCKET=healthcaredata-local-prod
# Local-Prod: Placeholder credentials - use actual credentials only in production
S3_ACCESS_KEY_ID=LOCAL_PROD_PLACEHOLDER_ACCESS_KEY
S3_SECRET_ACCESS_KEY=LOCAL_PROD_PLACEHOLDER_SECRET_KEY
S3_FORCE_PATH_STYLE=true
S3_PUBLIC_URL_EXPIRATION=3600
CDN_URL=http://localhost:8088/storage

# Dragonfly Password (if password-protected)
# Local-Prod: No password for local testing
DRAGONFLY_PASSWORD=

# Docker Configuration
DOCKER_ENV=true
DOCKER_NETWORK=local-prod_app_network
