generator client {
  provider        = "prisma-client-js"
  output          = "../../../../../node_modules/.prisma/client"
  previewFeatures = []
  binaryTargets   = ["native", "linux-musl"]
  engineType      = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                  @id @default(uuid())
  userid                  String                  @unique
  email                   String                  @unique
  password                String
  name                    String
  age                     Int
  firstName               String?
  lastName                String?
  phone                   String?
  role                    Role                    @default(PATIENT)
  profilePicture          String?
  gender                  String?
  dateOfBirth             DateTime?
  address                 String?
  city                    String?
  state                   String?
  country                 String?
  zipCode                 String?
  emergencyContact        String?
  isVerified              Boolean                 @default(false)
  lastLogin               DateTime?
  lastLoginIP             String?
  lastLoginDevice         String?
  createdAt               DateTime                @default(now())
  updatedAt               DateTime                @updatedAt
  passwordChangedAt       DateTime?
  googleId                String?
  facebookId              String?
  appleId                 String?
  appName                 String?
  medicalConditions       String?
  prakriti                Prakriti?
  vikriti                 String?
  doshaImbalances         Json?
  agni                    AgniType?
  dinacharya              String?
  ritucharya              String?
  dietaryRestrictionsJson Json?
  lifestyleFactors        Json?
  seasonalPatterns        Json?
  primaryClinicId         String?
  allergies               Allergy[]
  appointments            Appointment[]
  auditLogs               AuditLog[]
  ayurvedicPrescriptions  AyurvedicPrescription[]
  clinicAdmins            ClinicAdmin?
  counselor               Counselor?
  dietaryRestrictions     DietaryRestriction[]
  doctor                  Doctor?
  emergencyContacts       EmergencyContact[]
  familyHistories         FamilyHistory[]
  financeBilling          FinanceBilling?
  immunizations           Immunization[]
  insurances              Insurance[]
  labReports              LabReport[]
  labTechnician           LabTechnician?
  lifestyleAssessments    LifestyleAssessment[]
  medicalHistories        MedicalHistory[]
  medications             Medication[]
  mentalHealthNotes       MentalHealthNote[]
  nadiParikshas           NadiPariksha[]
  notifications           Notification[]
  nurse                   Nurse?
  patient                 Patient?
  pharmacist              Pharmacist?
  prakritiAnalyses        PrakritiAnalysis[]
  radiologyReports        RadiologyReport[]
  receptionists           Receptionist?
  superAdmin              SuperAdmin?
  supportStaff            SupportStaff?
  surgicalRecords         SurgicalRecord[]
  therapist               Therapist?
  userRoles               UserRole[]
  vitals                  Vital[]
  createdClinics          Clinic[]                @relation("UserCreatedClinics")
  primaryClinic           Clinic?                 @relation("UserPrimaryClinic", fields: [primaryClinicId], references: [id])
  videoParticipants       VideoParticipant[]
  clinics                 Clinic[]                @relation("UserClinics")

  @@index([primaryClinicId])
  @@index([email])
  @@index([role])
  @@map("users")
}

model Receptionist {
  id                    String                  @id @default(uuid())
  userId                String                  @unique
  clinicId              String?
  createdAt             DateTime                @default(now())
  clinic                Clinic?                 @relation(fields: [clinicId], references: [id])
  user                  User                    @relation(fields: [userId], references: [id])
  ReceptionistsAtClinic ReceptionistsAtClinic[]

  @@index([clinicId])
}

model Clinic {
  id                    String                       @id @default(uuid())
  clinicId              String                       @unique
  name                  String
  address               String
  phone                 String
  email                 String                       @unique
  app_name              String                       @unique
  db_connection_string  String
  databaseName          String?
  databaseStatus        DatabaseStatus               @default(CREATING)
  databaseCreatedAt     DateTime?
  databaseLastSync      DateTime?
  isActive              Boolean                      @default(true)
  createdAt             DateTime                     @default(now())
  updatedAt             DateTime                     @updatedAt
  createdBy             String
  subdomain             String?                      @unique
  logo                  String?
  website               String?
  description           String?
  timezone              String?                      @default("UTC")
  currency              String?                      @default("INR")
  language              String?                      @default("en")
  settings              Json?
  appointments          Appointment[]
  appointmentTemplates  AppointmentTemplate[]
  ayurvedicTherapies    AyurvedicTherapy[]
  businessRules         BusinessRule[]
  checkInLocations      CheckInLocation[]
  admins                ClinicAdmin[]
  doctors               DoctorClinic[]
  eligibilityChecks     EligibilityCheck[]
  eligibilityCriteria   EligibilityCriteria[]
  rbacRoles             RbacRole[]
  receptionists         Receptionist[]
  recurringSeries       RecurringAppointmentSeries[]
  resources             Resource[]
  resourceBookings      ResourceBooking[]
  rolePermissions       RolePermission[]
  therapyQueues         TherapyQueue[]
  therapySessions       TherapySession[]
  userRoles             UserRole[]
  waitlistEntries       WaitlistEntry[]
  ReceptionistsAtClinic ReceptionistsAtClinic[]
  locations             ClinicLocation[]
  createdByUser         User                         @relation("UserCreatedClinics", fields: [createdBy], references: [id])
  primaryUsers          User[]                       @relation("UserPrimaryClinic")
  videoConsultations    VideoConsultation[]
  users                 User[]                       @relation("UserClinics")

  @@index([app_name])
  @@index([isActive])
  @@map("clinics")
}

model ClinicLocation {
  id           String         @id @default(uuid())
  locationId   String         @unique
  name         String
  address      String
  city         String
  state        String
  country      String
  zipCode      String?
  phone        String?
  email        String?
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  clinicId     String
  latitude     Float?
  longitude    Float?
  timezone     String?        @default("UTC")
  workingHours Json?
  settings     Json?
  appointments Appointment[]
  doctorClinic DoctorClinic[]
  clinic       Clinic         @relation(fields: [clinicId], references: [id])

  @@index([clinicId])
  @@map("clinic_locations")
}

model SuperAdmin {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model ClinicAdmin {
  id        String   @id @default(uuid())
  userId    String   @unique
  clinicId  String
  createdAt DateTime @default(now())
  isOwner   Boolean  @default(false)
  clinic    Clinic   @relation(fields: [clinicId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([clinicId])
}

model Pharmacist {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Therapist {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model LabTechnician {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model FinanceBilling {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model SupportStaff {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Nurse {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Counselor {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Doctor {
  id                   String                @id @default(uuid())
  userId               String                @unique
  specialization       String
  experience           Int
  qualification        String?
  consultationFee      Float?
  rating               Float?                @default(0.0)
  isAvailable          Boolean               @default(true)
  workingHours         Json?
  createdAt            DateTime              @default(now())
  appointments         Appointment[]
  appointmentTemplates AppointmentTemplate[]
  user                 User                  @relation(fields: [userId], references: [id])
  clinics              DoctorClinic[]
  healthRecords        HealthRecord[]
  prescriptions        Prescription[]
  reviews              Review[]
  therapySessions      TherapySession[]
  waitlistEntries      WaitlistEntry[]
  videoConsultations   VideoConsultation[]
}

model Patient {
  id                 String                       @id @default(uuid())
  userId             String                       @unique
  prakriti           Prakriti?
  dosha              Dosha?
  createdAt          DateTime                     @default(now())
  appointments       Appointment[]
  checkIns           CheckIn[]
  eligibilityChecks  EligibilityCheck[]
  healthRecords      HealthRecord[]
  insurance          Insurance[]
  user               User                         @relation(fields: [userId], references: [id])
  prescriptions      Prescription[]
  queueEntries       QueueEntry[]
  recurringSeries    RecurringAppointmentSeries[]
  reviews            Review[]
  therapySessions    TherapySession[]
  waitlistEntries    WaitlistEntry[]
  videoConsultations VideoConsultation[]
}

model Appointment {
  id                  String              @id @default(uuid())
  type                AppointmentType
  doctorId            String
  patientId           String
  locationId          String
  clinicId            String
  date                DateTime
  time                String
  duration            Int
  status              AppointmentStatus
  priority            String?             @default("NORMAL")
  notes               String?
  userId              String
  updatedBy           String?
  cancellationReason  String?
  metadata            Json?
  cancelledBy         String?
  cancelledAt         DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  therapyId           String?
  startedAt           DateTime?
  checkedInAt         DateTime?
  completedAt         DateTime?
  subscriptionId      String?
  isSubscriptionBased Boolean             @default(false)
  clinic              Clinic              @relation(fields: [clinicId], references: [id])
  doctor              Doctor              @relation(fields: [doctorId], references: [id])
  location            ClinicLocation      @relation(fields: [locationId], references: [id])
  patient             Patient             @relation(fields: [patientId], references: [id])
  subscription        Subscription?       @relation(fields: [subscriptionId], references: [id])
  therapy             Therapy?            @relation(fields: [therapyId], references: [id])
  user                User                @relation(fields: [userId], references: [id])
  checkIns            CheckIn[]
  payment             Payment?
  queue               Queue?
  queueEntries        QueueEntry[]
  resourceBookings    ResourceBooking[]
  therapySessions     TherapySession[]
  VideoConsultation   VideoConsultation[]

  @@index([doctorId])
  @@index([patientId])
  @@index([locationId])
  @@index([clinicId])
  @@index([subscriptionId])
}

model Therapy {
  id           String        @id @default(uuid())
  name         String
  description  String?
  duration     Int?
  createdAt    DateTime      @default(now())
  clinicId     String
  appointments Appointment[]

  @@index([clinicId])
}

model Prescription {
  id        String             @id @default(uuid())
  patientId String
  doctorId  String
  date      DateTime           @default(now())
  notes     String?
  clinicId  String
  doctor    Doctor             @relation(fields: [doctorId], references: [id])
  patient   Patient            @relation(fields: [patientId], references: [id])
  items     PrescriptionItem[]

  @@index([clinicId])
}

model PrescriptionItem {
  id             String       @id @default(uuid())
  prescriptionId String
  medicineId     String?
  dosage         String?
  frequency      String?
  duration       String?
  clinicId       String
  medicine       Medicine?    @relation(fields: [medicineId], references: [id])
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])

  @@index([clinicId])
}

model Medicine {
  id                String             @id @default(uuid())
  name              String
  ingredients       String?
  properties        String?
  dosage            String?
  manufacturer      String?
  type              MedicineType
  clinicId          String
  prescriptionItems PrescriptionItem[]

  @@index([clinicId])
}

model DoctorClinic {
  doctorId   String
  clinicId   String
  startTime  DateTime?
  endTime    DateTime?
  locationId String?
  clinic     Clinic          @relation(fields: [clinicId], references: [id])
  doctor     Doctor          @relation(fields: [doctorId], references: [id])
  location   ClinicLocation? @relation(fields: [locationId], references: [id])

  @@id([doctorId, clinicId])
  @@index([clinicId])
}

model Payment {
  id             String         @id @default(uuid())
  appointmentId  String?        @unique
  amount         Float
  status         PaymentStatus  @default(PENDING)
  method         PaymentMethod?
  transactionId  String?
  clinicId       String
  userId         String?
  invoiceId      String?
  subscriptionId String?
  description    String?
  metadata       Json?
  refundAmount   Float?         @default(0)
  refundedAt     DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  appointment    Appointment?   @relation(fields: [appointmentId], references: [id])
  invoice        Invoice?       @relation(fields: [invoiceId], references: [id])
  subscription   Subscription?  @relation(fields: [subscriptionId], references: [id])

  @@index([clinicId])
  @@index([userId])
  @@index([status])
  @@index([subscriptionId])
}

model Subscription {
  id                    String             @id @default(uuid())
  userId                String
  planId                String
  clinicId              String
  status                SubscriptionStatus @default(ACTIVE)
  startDate             DateTime           @default(now())
  endDate               DateTime?
  currentPeriodStart    DateTime           @default(now())
  currentPeriodEnd      DateTime
  cancelAtPeriodEnd     Boolean            @default(false)
  cancelledAt           DateTime?
  trialStart            DateTime?
  trialEnd              DateTime?
  metadata              Json?
  appointmentsUsed      Int                @default(0)
  appointmentsRemaining Int?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  appointments          Appointment[]
  invoices              Invoice[]
  payments              Payment[]
  plan                  BillingPlan        @relation(fields: [planId], references: [id])

  @@index([userId])
  @@index([planId])
  @@index([clinicId])
  @@index([status])
}

model BillingPlan {
  id                      String          @id @default(uuid())
  name                    String
  description             String?
  amount                  Float
  currency                String          @default("INR")
  interval                BillingInterval @default(MONTHLY)
  intervalCount           Int             @default(1)
  trialPeriodDays         Int?
  features                Json?
  isActive                Boolean         @default(true)
  clinicId                String?
  metadata                Json?
  appointmentsIncluded    Int?
  isUnlimitedAppointments Boolean         @default(false)
  appointmentTypes        Json?
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  subscriptions           Subscription[]

  @@index([clinicId])
  @@index([isActive])
}

model Invoice {
  id              String        @id @default(uuid())
  invoiceNumber   String        @unique
  userId          String
  subscriptionId  String?
  clinicId        String
  amount          Float
  tax             Float?        @default(0)
  discount        Float?        @default(0)
  totalAmount     Float
  status          InvoiceStatus @default(DRAFT)
  dueDate         DateTime
  paidAt          DateTime?
  description     String?
  lineItems       Json?
  metadata        Json?
  pdfFilePath     String?
  pdfUrl          String?
  sentViaWhatsApp Boolean       @default(false)
  whatsappSentAt  DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  subscription    Subscription? @relation(fields: [subscriptionId], references: [id])
  payments        Payment[]

  @@index([userId])
  @@index([subscriptionId])
  @@index([clinicId])
  @@index([status])
  @@index([dueDate])
}

model Queue {
  id                String      @id @default(uuid())
  appointmentId     String      @unique
  queueNumber       Int
  estimatedWaitTime Int?
  status            QueueStatus @default(WAITING)
  clinicId          String
  updatedAt         DateTime    @updatedAt
  appointment       Appointment @relation(fields: [appointmentId], references: [id])

  @@index([clinicId])
}

model Notification {
  id        String             @id @default(uuid())
  userId    String
  type      NotificationType
  message   String
  read      Boolean            @default(false)
  sentAt    DateTime?
  status    NotificationStatus @default(PENDING)
  clinicId  String?
  createdAt DateTime           @default(now())
  user      User               @relation(fields: [userId], references: [id])

  @@index([clinicId])
}

model HealthRecord {
  id         String           @id @default(uuid())
  patientId  String
  doctorId   String
  recordType HealthRecordType
  report     String?
  fileUrl    String?
  clinicId   String
  createdAt  DateTime         @default(now())
  doctor     Doctor           @relation(fields: [doctorId], references: [id])
  patient    Patient          @relation(fields: [patientId], references: [id])

  @@index([clinicId])
}

model AuditLog {
  id           String   @id @default(uuid())
  userId       String
  action       String
  timestamp    DateTime @default(now())
  ipAddress    String?
  device       String?
  userAgent    String?
  description  String   @default("")
  resourceType String?
  resourceId   String?
  metadata     Json?
  clinicId     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@index([clinicId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([userId])
  @@index([timestamp])
}

model Review {
  id        String   @id @default(uuid())
  rating    Int      @default(0)
  comment   String?
  patientId String
  doctorId  String
  clinicId  String
  createdAt DateTime @default(now())
  doctor    Doctor   @relation(fields: [doctorId], references: [id])
  patient   Patient  @relation(fields: [patientId], references: [id])

  @@index([clinicId])
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Float
  category    String
  stock       Int      @default(0)
  clinicId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([clinicId])
}

model Log {
  id        String   @id @default(uuid())
  type      String
  level     String
  message   String
  context   String
  metadata  String?
  clinicId  String?
  timestamp DateTime @default(now())

  @@index([clinicId])
  @@index([timestamp])
  @@index([type])
  @@index([level])
  @@index([timestamp, type, level])
  @@map("logs")
}

model ReceptionistsAtClinic {
  A            String
  B            String
  clinics      Clinic       @relation(fields: [A], references: [id], onDelete: Cascade)
  Receptionist Receptionist @relation(fields: [B], references: [id], onDelete: Cascade)

  @@id([A, B], map: "_ReceptionistsAtClinic_AB_pkey")
  @@index([B], map: "_ReceptionistsAtClinic_B_index")
  @@map("_ReceptionistsAtClinic")
}

model MedicalHistory {
  id        String   @id @default(uuid())
  userId    String
  clinicId  String?
  condition String
  diagnosis String?
  treatment String?
  doctorId  String?
  notes     String?
  date      DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model LabReport {
  id          String   @id @default(uuid())
  userId      String
  clinicId    String?
  testName    String
  result      String
  unit        String?
  normalRange String?
  labName     String?
  doctorId    String?
  notes       String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model RadiologyReport {
  id         String   @id @default(uuid())
  userId     String
  clinicId   String?
  imageType  String
  findings   String
  conclusion String
  doctorId   String?
  notes      String?
  date       DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model SurgicalRecord {
  id          String   @id @default(uuid())
  userId      String
  clinicId    String?
  surgeryName String
  surgeon     String
  doctorId    String?
  notes       String?
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model MentalHealthNote {
  id          String   @id @default(uuid())
  userId      String
  clinicId    String?
  therapist   String
  sessionNote String
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
}

model Vital {
  id         String   @id @default(uuid())
  userId     String
  clinicId   String?
  type       String
  value      String
  unit       String?
  doctorId   String?
  notes      String?
  recordedAt DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model NadiPariksha {
  id           String   @id @default(uuid())
  userId       String
  diagnosis    String
  pulseType    String
  notes        String?
  date         DateTime
  practitioner String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model AyurvedicPrescription {
  id           String   @id @default(uuid())
  userId       String
  formulation  String
  dosage       String
  duration     String
  instructions String?
  prescribedAt DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model PrakritiAnalysis {
  id           String   @id @default(uuid())
  userId       String
  vataLevel    Int
  pittaLevel   Int
  kaphaLevel   Int
  dominantType String
  notes        String?
  assessedAt   DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Immunization {
  id               String    @id @default(uuid())
  userId           String
  clinicId         String?
  vaccineName      String
  dateAdministered DateTime
  nextDueDate      DateTime?
  batchNumber      String?
  administrator    String?
  location         String?
  doctorId         String?
  notes            String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  user             User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model Allergy {
  id            String   @id @default(uuid())
  userId        String
  clinicId      String?
  allergen      String
  severity      String
  reaction      String
  diagnosedDate DateTime
  doctorId      String?
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model FamilyHistory {
  id           String   @id @default(uuid())
  userId       String
  clinicId     String?
  relation     String
  condition    String
  diagnosedAge Int?
  doctorId     String?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model LifestyleAssessment {
  id         String   @id @default(uuid())
  userId     String
  clinicId   String?
  diet       String?
  exercise   String?
  smoking    String?
  alcohol    String?
  sleep      String?
  stress     String?
  occupation String?
  doctorId   String?
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model EmergencyContact {
  id             String   @id @default(uuid())
  userId         String
  name           String
  relationship   String
  phone          String
  alternatePhone String?
  address        String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Insurance {
  id                String    @id @default(uuid())
  userId            String
  provider          String
  policyNumber      String
  groupNumber       String?
  primaryHolder     String
  coverageStartDate DateTime
  coverageEndDate   DateTime?
  coverageType      String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  patientId         String?
  Patient           Patient?  @relation(fields: [patientId], references: [id])
  user              User      @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Medication {
  id           String    @id @default(uuid())
  userId       String
  clinicId     String?
  name         String
  dosage       String
  frequency    String
  startDate    DateTime
  endDate      DateTime?
  prescribedBy String
  purpose      String?
  sideEffects  String?
  doctorId     String?
  notes        String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([clinicId])
  @@index([doctorId])
}

model DietaryRestriction {
  id           String    @id @default(uuid())
  userId       String
  restriction  String
  reason       String?
  startDate    DateTime
  endDate      DateTime?
  prescribedBy String?
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Permission {
  id                 String           @id @default(uuid())
  name               String
  resource           String
  action             String
  description        String?
  domain             String           @default("healthcare")
  isSystemPermission Boolean          @default(false)
  isActive           Boolean          @default(true)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  rolePermissions    RolePermission[]

  @@unique([resource, action, domain])
  @@index([resource, action])
  @@index([domain])
}

model RbacRole {
  id           String           @id @default(uuid())
  name         String
  displayName  String
  description  String?
  domain       String           @default("healthcare")
  clinicId     String?
  isSystemRole Boolean          @default(false)
  isActive     Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  clinic       Clinic?          @relation(fields: [clinicId], references: [id])
  permissions  RolePermission[]
  userRoles    UserRole[]

  @@unique([name, domain, clinicId])
  @@index([domain, clinicId])
}

model UserRole {
  id          String    @id @default(uuid())
  userId      String
  roleId      String
  clinicId    String?
  assignedBy  String    @default("SYSTEM")
  assignedAt  DateTime  @default(now())
  expiresAt   DateTime?
  revokedAt   DateTime?
  revokedBy   String?
  isActive    Boolean   @default(true)
  isPrimary   Boolean   @default(false)
  permissions Json?
  schedule    Json?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  clinic      Clinic?   @relation(fields: [clinicId], references: [id])
  role        RbacRole  @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId, clinicId])
  @@index([userId])
  @@index([roleId])
  @@index([clinicId])
  @@index([isPrimary])
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  clinicId     String?
  isActive     Boolean    @default(true)
  assignedAt   DateTime   @default(now())
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  clinic       Clinic?    @relation(fields: [clinicId], references: [id])
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         RbacRole   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId, clinicId])
  @@index([roleId])
  @@index([permissionId])
  @@index([clinicId])
}

model BusinessRule {
  id          String   @id @default(uuid())
  name        String
  description String
  priority    Int      @default(1)
  isActive    Boolean  @default(true)
  conditions  Json
  actions     Json
  clinicId    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  clinic      Clinic?  @relation(fields: [clinicId], references: [id])

  @@index([clinicId])
  @@index([isActive, priority])
}

model EligibilityCriteria {
  id          String   @id @default(uuid())
  name        String
  description String
  clinicId    String
  conditions  Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  clinic      Clinic   @relation(fields: [clinicId], references: [id])

  @@index([clinicId])
  @@index([isActive])
}

model EligibilityCheck {
  id              String   @id @default(uuid())
  patientId       String
  appointmentType String
  clinicId        String
  requestedDate   DateTime
  criteria        Json
  result          Json
  checkedAt       DateTime @default(now())
  clinic          Clinic   @relation(fields: [clinicId], references: [id])
  patient         Patient  @relation(fields: [patientId], references: [id])

  @@index([patientId])
  @@index([clinicId])
  @@index([checkedAt])
}

model AppointmentTemplate {
  id                         String                       @id @default(uuid())
  name                       String
  description                String?
  clinicId                   String
  doctorId                   String
  type                       String
  duration                   Int
  timeSlots                  Json
  recurringPattern           String
  recurringDays              Json?
  recurringInterval          Int                          @default(1)
  startDate                  DateTime
  endDate                    DateTime?
  isActive                   Boolean                      @default(true)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  clinic                     Clinic                       @relation(fields: [clinicId], references: [id])
  doctor                     Doctor                       @relation(fields: [doctorId], references: [id])
  RecurringAppointmentSeries RecurringAppointmentSeries[]

  @@index([clinicId])
  @@index([doctorId])
  @@index([isActive])
}

model RecurringAppointmentSeries {
  id         String              @id @default(uuid())
  templateId String
  patientId  String
  clinicId   String
  startDate  DateTime
  endDate    DateTime
  status     String              @default("active")
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  clinic     Clinic              @relation(fields: [clinicId], references: [id])
  patient    Patient             @relation(fields: [patientId], references: [id])
  template   AppointmentTemplate @relation(fields: [templateId], references: [id])

  @@index([templateId])
  @@index([patientId])
  @@index([clinicId])
}

model WaitlistEntry {
  id                  String             @id @default(uuid())
  patientId           String
  doctorId            String
  clinicId            String
  priority            Int                @default(1)
  status              String             @default("waiting")
  requestedDate       DateTime
  notes               String?
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  videoConsultationId String?
  clinic              Clinic             @relation(fields: [clinicId], references: [id])
  doctor              Doctor             @relation(fields: [doctorId], references: [id])
  patient             Patient            @relation(fields: [patientId], references: [id])
  videoConsultation   VideoConsultation? @relation(fields: [videoConsultationId], references: [id])

  @@index([patientId])
  @@index([doctorId])
  @@index([clinicId])
  @@index([status, priority])
}

model Resource {
  id              String            @id @default(uuid())
  name            String
  type            String
  clinicId        String
  capacity        Int?
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  clinic          Clinic            @relation(fields: [clinicId], references: [id])
  ResourceBooking ResourceBooking[]

  @@index([clinicId])
  @@index([type])
  @@index([isActive])
}

model ResourceBooking {
  id            String       @id @default(uuid())
  resourceId    String
  appointmentId String?
  startTime     DateTime
  endTime       DateTime
  status        String       @default("booked")
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  clinicId      String?
  appointment   Appointment? @relation(fields: [appointmentId], references: [id])
  Clinic        Clinic?      @relation(fields: [clinicId], references: [id])
  resource      Resource     @relation(fields: [resourceId], references: [id])

  @@index([resourceId])
  @@index([appointmentId])
  @@index([startTime, endTime])
}

model VideoConsultation {
  id                   String             @id @default(uuid())
  appointmentId        String
  patientId            String
  doctorId             String
  clinicId             String
  roomId               String             @unique
  meetingUrl           String
  status               VideoCallStatus    @default(SCHEDULED)
  startTime            DateTime?
  endTime              DateTime?
  duration             Int?
  recordingUrl         String?
  recordingId          String?
  isRecording          Boolean            @default(false)
  maxParticipants      Int                @default(2)
  recordingEnabled     Boolean            @default(true)
  screenSharingEnabled Boolean            @default(true)
  chatEnabled          Boolean            @default(true)
  waitingRoomEnabled   Boolean            @default(true)
  autoRecord           Boolean            @default(false)
  iceServers           Json?
  turnServers          Json?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  WaitlistEntry        WaitlistEntry[]
  appointment          Appointment        @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  clinic               Clinic             @relation(fields: [clinicId], references: [id], onDelete: Cascade)
  doctor               Doctor             @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  patient              Patient            @relation(fields: [patientId], references: [id], onDelete: Cascade)
  participants         VideoParticipant[]
  recordings           VideoRecording[]

  @@index([appointmentId])
  @@index([patientId])
  @@index([doctorId])
  @@index([clinicId])
  @@index([status])
  @@map("video_consultations")
}

model VideoParticipant {
  id                String                 @id @default(uuid())
  consultationId    String
  userId            String
  role              VideoParticipantRole   @default(PARTICIPANT)
  status            VideoParticipantStatus @default(INVITED)
  joinedAt          DateTime?
  leftAt            DateTime?
  duration          Int?
  peerId            String?
  connectionId      String?
  isAudioEnabled    Boolean                @default(true)
  isVideoEnabled    Boolean                @default(true)
  isScreenSharing   Boolean                @default(false)
  audioQuality      Float?
  videoQuality      Float?
  connectionQuality Float?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  consultation      VideoConsultation      @relation(fields: [consultationId], references: [id], onDelete: Cascade)
  user              User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([consultationId])
  @@index([userId])
  @@index([status])
  @@map("video_participants")
}

model VideoRecording {
  id              String            @id @default(uuid())
  consultationId  String
  fileName        String
  filePath        String
  fileSize        BigInt?
  duration        Int?
  format          String            @default("mp4")
  quality         String            @default("720p")
  storageProvider String            @default("local")
  storageUrl      String?
  isProcessed     Boolean           @default(false)
  isPublic        Boolean           @default(false)
  accessToken     String?
  expiresAt       DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  consultation    VideoConsultation @relation(fields: [consultationId], references: [id], onDelete: Cascade)

  @@index([consultationId])
  @@index([isProcessed])
  @@map("video_recordings")
}

model AyurvedicTherapy {
  id                String           @id @default(uuid())
  name              String
  description       String?
  therapyType       TherapyType
  duration          TherapyDuration
  estimatedDuration Int
  isActive          Boolean          @default(true)
  clinicId          String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  clinic            Clinic           @relation(fields: [clinicId], references: [id])
  sessions          TherapySession[]

  @@index([clinicId])
  @@index([therapyType])
}

model TherapySession {
  id              String           @id @default(uuid())
  therapyId       String
  appointmentId   String
  patientId       String
  doctorId        String
  clinicId        String
  sessionDate     DateTime
  startTime       DateTime
  endTime         DateTime?
  status          TherapyStatus    @default(SCHEDULED)
  notes           String?
  observations    Json?
  nextSessionDate DateTime?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  appointment     Appointment      @relation(fields: [appointmentId], references: [id])
  clinic          Clinic           @relation(fields: [clinicId], references: [id])
  doctor          Doctor           @relation(fields: [doctorId], references: [id])
  patient         Patient          @relation(fields: [patientId], references: [id])
  therapy         AyurvedicTherapy @relation(fields: [therapyId], references: [id])

  @@index([therapyId])
  @@index([appointmentId])
  @@index([patientId])
  @@index([doctorId])
  @@index([clinicId])
  @@index([sessionDate])
}

model TherapyQueue {
  id                String       @id @default(uuid())
  clinicId          String
  therapyType       TherapyType
  queueName         String
  isActive          Boolean      @default(true)
  maxCapacity       Int          @default(10)
  currentPosition   Int          @default(0)
  estimatedWaitTime Int?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  queueEntries      QueueEntry[]
  clinic            Clinic       @relation(fields: [clinicId], references: [id])

  @@index([clinicId])
  @@index([therapyType])
  @@index([isActive])
}

model QueueEntry {
  id                String       @id @default(uuid())
  queueId           String
  appointmentId     String
  patientId         String
  position          Int
  status            QueueStatus  @default(WAITING)
  estimatedWaitTime Int?
  actualWaitTime    Int?
  checkedInAt       DateTime?
  startedAt         DateTime?
  completedAt       DateTime?
  priority          Int          @default(0)
  notes             String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  appointment       Appointment  @relation(fields: [appointmentId], references: [id])
  patient           Patient      @relation(fields: [patientId], references: [id])
  queue             TherapyQueue @relation(fields: [queueId], references: [id])

  @@index([queueId])
  @@index([appointmentId])
  @@index([patientId])
  @@index([status])
  @@index([position])
}

model CheckInLocation {
  id           String    @id @default(uuid())
  clinicId     String
  locationName String
  qrCode       String    @unique
  coordinates  Json
  radius       Float
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  checkIns     CheckIn[]
  clinic       Clinic    @relation(fields: [clinicId], references: [id])

  @@index([clinicId])
  @@index([qrCode])
}

model CheckIn {
  id            String          @id @default(uuid())
  appointmentId String
  locationId    String
  patientId     String
  checkedInAt   DateTime        @default(now())
  coordinates   Json?
  deviceInfo    Json?
  isVerified    Boolean         @default(false)
  verifiedBy    String?
  notes         String?
  appointment   Appointment     @relation(fields: [appointmentId], references: [id])
  location      CheckInLocation @relation(fields: [locationId], references: [id])
  patient       Patient         @relation(fields: [patientId], references: [id])

  @@index([appointmentId])
  @@index([locationId])
  @@index([patientId])
  @@index([checkedInAt])
}

enum Role {
  SUPER_ADMIN
  CLINIC_ADMIN
  DOCTOR
  PATIENT
  RECEPTIONIST
  PHARMACIST
  THERAPIST
  LAB_TECHNICIAN
  FINANCE_BILLING
  SUPPORT_STAFF
  NURSE
  COUNSELOR
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AppointmentStatus {
  SCHEDULED
  CHECKED_IN
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
  PENDING
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CASH
  CARD
  UPI
  NET_BANKING
  WALLET
  INSURANCE
}

enum QueueStatus {
  WAITING
  IN_PROGRESS
  COMPLETED
}

enum HealthRecordType {
  LAB_TEST
  XRAY
  MRI
  PRESCRIPTION
  DIAGNOSIS_REPORT
  PULSE_DIAGNOSIS
}

enum NotificationType {
  EMAIL
  SMS
  PUSH_NOTIFICATION
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}

enum AppointmentType {
  IN_PERSON
  VIDEO_CALL
  HOME_VISIT
  VIDDHAKARMA
  AGNIKARMA
  PANCHAKARMA
  NADI_PARIKSHA
  DOSHA_ANALYSIS
  SHIRODHARA
  VIRECHANA
  ABHYANGA
  SWEDANA
  BASTI
  NASYA
  RAKTAMOKSHANA
}

enum Dosha {
  VATA
  PITTA
  KAPHA
}

enum Prakriti {
  VATA
  PITTA
  KAPHA
  VATA_PITTA
  PITTA_KAPHA
  VATA_KAPHA
  TRIDOSHA
}

enum MedicineType {
  CLASSICAL
  PROPRIETARY
  HERBAL
}

enum DatabaseStatus {
  CREATING
  ACTIVE
  ERROR
  MIGRATING
  DISABLED
}

enum TherapyType {
  SHODHANA
  SHAMANA
  RASAYANA
  VAJIKARANA
}

enum TherapyDuration {
  SHORT
  MEDIUM
  LONG
  EXTENDED
  RESIDENTIAL
}

enum AgniType {
  TIKSHNA
  MANDA
  SAMA
  VISHAMA
}

enum TherapyStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  PAUSED
}

enum VideoCallStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
  FAILED
}

enum VideoParticipantRole {
  HOST
  PARTICIPANT
  OBSERVER
}

enum VideoParticipantStatus {
  INVITED
  JOINED
  LEFT
  DISCONNECTED
  FAILED
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELLED
  INCOMPLETE
  INCOMPLETE_EXPIRED
  TRIALING
  PAUSED
}

enum BillingInterval {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum InvoiceStatus {
  DRAFT
  OPEN
  PAID
  VOID
  UNCOLLECTIBLE
  OVERDUE
}
